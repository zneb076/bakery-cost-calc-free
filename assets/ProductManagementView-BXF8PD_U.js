import{e as i,j as D,f as F,c as a,a as e,k as R,g as _,l as T,v as j,d as r,z as w,A as h,F as S,h as L,t as f,m as b,r as O,b as k,n as z,o as l}from"./index-CmOtQ4OJ.js";import{d as c,S as C}from"./sweetalert2.esm.all-BdfwKlh3.js";import{_ as E,a as J}from"./ActionMenu-DNDxRFjM.js";import"./default.css_vue_type_style_index_0_src_true_lang-COY7eQaF.js";const q={class:"rounded-lg bg-white p-4 shadow-md"},Q={class:"mb-6 flex flex-col justify-between gap-4 md:flex-row md:items-center"},U={class:"relative w-full md:w-64"},G={class:"overflow-hidden rounded-lg bg-white shadow-sm"},H={class:"mb-[100px] min-w-full"},K={key:0},W={key:1},X={class:"border-b hover:bg-gray-50"},Y={class:"px-4 py-3"},Z={class:"px-4 py-3"},ee={class:"flex items-center justify-center space-x-3"},te=["onClick"],se={class:"py-1"},oe=["onClick"],le=["onClick"],ae={key:0},ne={colspan:"2",class:"bg-gray-50 p-4 text-sm"},ie={class:"space-y-1"},fe={__name:"ProductManagementView",setup(re){const m=i([]),v=i([]),u=i(!1),d=i(null),n=i(""),y=i(null);async function x(){try{const[s,t]=await Promise.all([c.products.toArray(),c.recipes.toArray()]);m.value=s,v.value=t}catch(s){console.error("Failed to fetch data:",s)}}D(x);const B=F(()=>n.value?m.value.filter(s=>s.name.toLowerCase().includes(n.value.toLowerCase())):m.value);function $(s){y.value=y.value===s?null:s}function M(){d.value={name:"",recipeId:null,weight:null,price:null},u.value=!0}function A(s){d.value=s,u.value=!0}function g(){u.value=!1,d.value=null}async function V(s){const t=JSON.parse(JSON.stringify(s));try{t.id?await c.products.update(t.id,t):await c.products.add(t),g(),await x(),C.fire({toast:!0,position:"top-end",icon:"success",title:"บันทึกสำเร็จ",showConfirmButton:!1,timer:3e3})}catch(p){console.error("Save failed:",p)}}async function I(s,t){(await C.fire({title:`ลบสินค้า "${t}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ใช่, ลบเลย",cancelButtonText:"ยกเลิก"})).isConfirmed&&(await c.products.delete(s),await x(),C.fire({toast:!0,position:"top-end",icon:"success",title:"ลบสำเร็จ",showConfirmButton:!1,timer:3e3}))}function P(s){return v.value.find(t=>t.id===s)?.name||"N/A"}return(s,t)=>{const p=O("router-link");return l(),a("div",q,[e("div",Q,[t[2]||(t[2]=e("h1",{class:"text-3xl font-bold"},"จัดการสินค้า (ขนม)",-1)),e("button",{onClick:M,class:"rounded-lg bg-primary px-4 py-2 text-white"}," + เพิ่มราการขนมใหม่ "),e("div",U,[T(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),placeholder:"ค้นหารายการขนม...",class:"w-full rounded-md border border-gray-300 px-3 py-2 pr-10"},null,512),[[j,n.value]]),n.value?(l(),a("button",{key:0,onClick:t[1]||(t[1]=o=>n.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700"},[r(w(h),{icon:"xmark"})])):_("",!0)])]),e("div",G,[e("table",H,[t[7]||(t[7]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"w-full px-4 py-2 text-left"},"ชื่อสินค้า"),e("th",{class:"px-4 py-2 text-center"},"จัดการ")])],-1)),B.value.length===0?(l(),a("tbody",K,t[3]||(t[3]=[e("tr",null,[e("td",{colspan:"2",class:"py-4 text-center text-gray-500"}," ไม่พบข้อมูล... ")],-1)]))):(l(),a("tbody",W,[(l(!0),a(S,null,L(B.value,o=>(l(),a(S,{key:o.id},[e("tr",X,[e("td",Y,f(o.name),1),e("td",Z,[e("div",ee,[e("button",{class:"text-gray-500 transition-colors hover:text-green-600",onClick:N=>$(o.id)},[r(w(h),{icon:"eye"})],8,te),r(p,{to:{name:"Calculator",query:{productId:o.id}},class:"text-gray-500 hover:text-yellow-600",title:"คำนวณต้นทุน (Basic)"},{default:b(()=>[r(w(h),{icon:"calculator",size:"lg"})]),_:2},1032,["to"]),r(E,null,{default:b(()=>[e("div",se,[e("button",{onClick:N=>A(o),class:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100"}," แก้ไข ",8,oe),e("button",{onClick:N=>I(o.id,o.name),class:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-gray-100"}," ลบ ",8,le)])]),_:2},1024)])])]),y.value===o.id?(l(),a("tr",ae,[e("td",ne,[e("ul",ie,[e("li",null,[t[4]||(t[4]=e("strong",null,"มาจากสูตร:",-1)),k(" "+f(P(o.recipeId)),1)]),e("li",null,[t[5]||(t[5]=e("strong",null,"น้ำหนัก:",-1)),k(" "+f(o.weight)+" กรัม",1)]),e("li",null,[t[6]||(t[6]=e("strong",null,"ราคาขาย:",-1)),k(" "+f(o.price)+" บาท",1)])])])])):_("",!0)],64))),128))]))])]),u.value?(l(),R(z,{key:0,onClose:g},{default:b(()=>[r(J,{"initial-data":d.value,"available-recipes":v.value,onSave:V,onCancel:g},null,8,["initial-data","available-recipes"])]),_:1})):_("",!0)])}}};export{fe as default};
