import{r,g as D,c as F,a as l,b as e,h as R,d as b,j as T,v as j,i,y as _,z as w,F as S,e as L,t as f,m as h,l as O,k,_ as z,o}from"./index-Pt9Kzntc.js";import{d,S as C}from"./sweetalert2.esm.all-BdfwKlh3.js";import{_ as E,a as J}from"./ActionMenu-UmR3_oio.js";import"./default.css_vue_type_style_index_0_src_true_lang-OcFN8sT0.js";const q={class:"rounded-lg bg-white p-4 shadow-md dark:bg-gray-700"},Q={class:"relative mb-5 w-full md:w-64"},U={class:"overflow-hidden rounded-lg bg-white shadow-sm dark:bg-gray-500"},G={class:"mb-[100px] min-w-full"},H={key:0},K={key:1},W={class:"border-b hover:bg-gray-50 dark:border-b-gray-400 dark:bg-gray-500 hover:dark:bg-gray-400"},X={class:"px-4 py-3"},Y={class:"px-4 py-3"},Z={class:"flex items-center justify-center space-x-3"},ee=["onClick"],te={class:"py-1"},ae=["onClick"],se=["onClick"],oe={key:0},le={colspan:"2",class:"bg-gray-50 p-4 text-sm dark:bg-gray-600"},ne={class:"space-y-1"},pe={__name:"ProductManagementView",setup(re){const y=r([]),g=r([]),c=r(!1),u=r(null),n=r(""),m=r(null);async function v(){try{const[a,t]=await Promise.all([d.products.toArray(),d.recipes.toArray()]);y.value=a,g.value=t}catch(a){console.error("Failed to fetch data:",a)}}D(v);const B=F(()=>n.value?y.value.filter(a=>a.name.toLowerCase().includes(n.value.toLowerCase())):y.value);function $(a){m.value=m.value===a?null:a}function M(){u.value={name:"",recipeId:null,weight:null,price:null},c.value=!0}function V(a){u.value=a,c.value=!0}function x(){c.value=!1,u.value=null}async function A(a){const t=JSON.parse(JSON.stringify(a));try{t.id?await d.products.update(t.id,t):await d.products.add(t),x(),await v(),C.fire({toast:!0,position:"top-end",icon:"success",title:"บันทึกสำเร็จ",showConfirmButton:!1,timer:3e3})}catch(p){console.error("Save failed:",p)}}async function I(a,t){(await C.fire({title:`ลบสินค้า "${t}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ใช่, ลบเลย",cancelButtonText:"ยกเลิก"})).isConfirmed&&(await d.products.delete(a),await v(),C.fire({toast:!0,position:"top-end",icon:"success",title:"ลบสำเร็จ",showConfirmButton:!1,timer:3e3}))}function P(a){return g.value.find(t=>t.id===a)?.name||"N/A"}return(a,t)=>{const p=O("router-link");return o(),l("div",q,[e("div",{class:"mb-6 flex justify-between gap-4 md:flex-row md:items-center"},[t[2]||(t[2]=e("h1",{class:"text-2xl font-bold"},"จัดการสินค้า (ขนม)",-1)),e("button",{onClick:M,class:"dark:bg-primary-dark rounded-lg bg-primary px-4 py-2 text-white dark:text-gray-600"}," + เพิ่มรายการใหม่ ")]),e("div",Q,[T(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),placeholder:"ค้นหารายการขนม...",class:"w-full rounded-md border border-gray-300 px-3 py-2 pr-10 dark:text-gray-600"},null,512),[[j,n.value]]),n.value?(o(),l("button",{key:0,onClick:t[1]||(t[1]=s=>n.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700"},[i(_(w),{icon:"xmark"})])):b("",!0)]),e("div",U,[e("table",G,[t[7]||(t[7]=e("thead",{class:"bg-gray-100 dark:bg-gray-800"},[e("tr",null,[e("th",{class:"w-full px-4 py-2 text-left"},"ชื่อสินค้า"),e("th",{class:"px-4 py-2 text-center"},"จัดการ")])],-1)),B.value.length===0?(o(),l("tbody",H,t[3]||(t[3]=[e("tr",null,[e("td",{colspan:"2",class:"py-4 text-center text-gray-500"}," ไม่พบข้อมูล... ")],-1)]))):(o(),l("tbody",K,[(o(!0),l(S,null,L(B.value,s=>(o(),l(S,{key:s.id},[e("tr",W,[e("td",X,f(s.name),1),e("td",Y,[e("div",Z,[e("button",{class:"text-gray-500 transition-colors hover:text-green-600 dark:text-slate-200",onClick:N=>$(s.id)},[i(_(w),{icon:"eye"})],8,ee),i(p,{to:{name:"Calculator",query:{productId:s.id}},class:"text-gray-500 hover:text-yellow-600 dark:text-slate-200",title:"คำนวณต้นทุน (Basic)"},{default:h(()=>[i(_(w),{icon:"calculator",size:"lg"})]),_:2},1032,["to"]),i(E,null,{default:h(()=>[e("div",te,[e("button",{onClick:N=>V(s),class:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100"}," แก้ไข ",8,ae),e("button",{onClick:N=>I(s.id,s.name),class:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-gray-100"}," ลบ ",8,se)])]),_:2},1024)])])]),m.value===s.id?(o(),l("tr",oe,[e("td",le,[e("ul",ne,[e("li",null,[t[4]||(t[4]=e("strong",null,"มาจากสูตร:",-1)),k(" "+f(P(s.recipeId)),1)]),e("li",null,[t[5]||(t[5]=e("strong",null,"น้ำหนัก:",-1)),k(" "+f(s.weight)+" กรัม",1)]),e("li",null,[t[6]||(t[6]=e("strong",null,"ราคาขาย:",-1)),k(" "+f(s.price)+" บาท",1)])])])])):b("",!0)],64))),128))]))])]),c.value?(o(),R(z,{key:0,onClose:x},{default:h(()=>[i(J,{"initial-data":u.value,"available-recipes":g.value,onSave:A,onCancel:x},null,8,["initial-data","available-recipes"])]),_:1})):b("",!0)])}}};export{pe as default};
