import{r as b,c as tt,w as ut,a as r,o as a,b as t,t as l,j as q,v as W,F as M,e as N,i as I,y as et,z as Pt,f as Nt,g as It,d as G,h as at,l as Ut,k as C,x as $t,m as rt,_ as dt,n as X}from"./index-XM_L99Nl.js";import{S as y,d as P}from"./sweetalert2.esm.all-BdfwKlh3.js";import{s as ct}from"./default.css_vue_type_style_index_0_src_true_lang-CR6vzaxX.js";const Ft={class:"p-4"},Lt={class:"mb-4 text-2xl font-semibold"},Gt={class:"space-y-4"},Rt={class:"border-t pt-4"},Bt={class:"space-y-3"},Vt={class:"flex items-end space-x-2"},Dt={class:"flex-grow"},Et={class:"w-20 flex-shrink-0"},Tt=["onUpdate:modelValue"],jt=["onClick"],Ot={class:"flex justify-end space-x-3 bg-gray-50 px-6 py-3"},At={__name:"BreakEvenAnalysisForm",props:{initialData:{type:Object,required:!0},availableProducts:{type:Array,required:!0}},emits:["save","cancel"],setup(st,{emit:R}){const w=st,B=R,m=b({}),T=tt(()=>w.availableProducts.map(x=>({value:x.id,label:`${x.name} (${x.price} บาท)`})));ut(()=>w.initialData,x=>{m.value=JSON.parse(JSON.stringify(x)),(!m.value.products||m.value.products.length===0)&&(m.value.products=[{productId:null,salesMix:null}])},{immediate:!0,deep:!0});function U(){m.value.products.push({productId:null,salesMix:null})}function i(x){m.value.products.splice(x,1)}function F(){if(!m.value.name||!m.value.name.trim()){y.fire("ข้อมูลไม่ครบถ้วน","กรุณาใส่ชื่อกลุ่ม","error");return}const x=m.value.products.filter(d=>d.productId&&d.salesMix>0);if(x.length===0){y.fire("ข้อมูลไม่ครบถ้วน","กรุณาเลือกสินค้าและใส่สัดส่วนการขายอย่างน้อย 1 รายการ","error");return}B("save",{...m.value,products:x})}return(x,d)=>(a(),r("form",{onSubmit:Nt(F,["prevent"])},[t("div",Ft,[t("h3",Lt,l(m.value.id?"แก้ไขกลุ่ม":"สร้างกลุ่มสำหรับหาจุดคุ้มทุน"),1),t("div",Gt,[t("div",null,[d[2]||(d[2]=t("label",{class:"block text-sm font-medium"},"ชื่อกลุ่ม",-1)),q(t("input",{"onUpdate:modelValue":d[0]||(d[0]=h=>m.value.name=h),type:"text",class:"mt-1 w-full rounded-md border p-2"},null,512),[[W,m.value.name]])]),t("div",Rt,[d[5]||(d[5]=t("h4",{class:"mb-2 font-semibold"},"รายการสินค้าในกลุ่ม",-1)),t("div",Bt,[(a(!0),r(M,null,N(m.value.products,(h,L)=>(a(),r("div",{key:L,class:"rounded-lg bg-gray-50 p-3"},[t("div",Vt,[t("div",Dt,[d[3]||(d[3]=t("label",{class:"block text-xs font-medium text-gray-600"},"สินค้า",-1)),I(et(ct),{modelValue:h.productId,"onUpdate:modelValue":k=>h.productId=k,options:T.value,placeholder:"เลือกสินค้า",class:"mt-1"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",Et,[d[4]||(d[4]=t("label",{class:"block text-xs font-medium text-gray-600"},"สัดส่วนการขาย (%)",-1)),q(t("input",{"onUpdate:modelValue":k=>h.salesMix=k,type:"number",placeholder:"สัดส่วน",class:"mt-1 w-20 rounded-md border p-2"},null,8,Tt),[[W,h.salesMix,void 0,{number:!0}]])]),t("button",{onClick:k=>i(L),type:"button",class:"flex h-5 w-5 flex-shrink-0 items-center justify-center py-5 text-red-500"},[I(et(Pt),{icon:"trash"})],8,jt)])]))),128))]),t("button",{onClick:U,type:"button",class:"mt-4 font-semibold text-primary"}," + เพิ่มสินค้า ")])])]),t("div",Ot,[t("button",{type:"button",onClick:d[1]||(d[1]=h=>B("cancel")),class:"rounded-md border bg-white px-4 py-2"}," ยกเลิก "),d[6]||(d[6]=t("button",{type:"submit",class:"rounded-md bg-primary px-4 py-2 text-white"}," บันทึกกลุ่ม ",-1))])],32))}},Jt={key:0,class:"py-10 text-center"},qt={key:1},Wt={class:"border-t pt-4"},zt={class:"mb-4"},Qt={class:"space-y-3"},Yt={class:"flex items-end space-x-2"},Ht={class:"flex-grow"},Kt={class:"w-24 flex-shrink-0"},Xt=["onUpdate:modelValue"],Zt=["onClick"],te={class:"rounded-lg bg-white p-6 shadow-md dark:bg-gray-700"},ee={class:"min-w-full"},se={key:0},oe={class:"py-2"},ne={class:"font-semibold"},le={class:"text-xs text-gray-500 dark:text-slate-200"},ie={class:"space-x-2 py-2 text-right"},ae={class:"flex flex-col items-center gap-4 dark:text-gray-600"},re=["onClick"],de={class:"flex gap-4"},ue=["onClick"],ce=["onClick"],pe={class:"flex items-center justify-between"},me={class:"text-2xl font-semibold"},ve={class:"dark:text-primary-dark text-primary"},be={class:"min-w-full border text-sm dark:border-gray-700"},xe={class:"px-3 py-2"},ge={class:"px-3 py-2 text-right"},fe={class:"px-3 py-2 text-right text-red-500"},ye={class:"px-3 py-2 text-right text-green-600"},he={class:"grid grid-cols-1 gap-4 text-center md:grid-cols-2"},ke={class:"rounded-lg bg-green-100 p-4"},we={class:"text-3xl font-bold text-green-700"},_e={class:"rounded-lg bg-blue-100 p-4"},Ce={class:"text-3xl font-bold text-blue-700"},Me={class:"list-inside list-disc"},Se={class:"min-w-full rounded-md"},Pe=["onClick"],Ne={class:"px-4 py-2 text-right"},Ie={class:"px-4 py-2 text-right"},Ue={key:0},$e={colspan:"3",class:"bg-gray-50 p-4 dark:bg-gray-600"},Fe={class:"list-inside list-disc space-y-1 text-sm"},Le={class:"font-bold"},Ge={key:0,class:"p-3"},Re={class:"space-y-6 text-sm"},Be={class:"rounded-md bg-gray-50 p-3"},Ve={class:"w-full"},De={class:"py-1 pr-2"},Ee={class:"py-1 text-right"},Te={class:"py-1 text-right font-semibold"},je={class:"rounded-md bg-gray-50 p-3"},Oe={class:"mt-1 border-t pt-1"},Ae={class:"font-semibold"},Je={class:"rounded-md bg-gray-50 p-3"},qe={class:"text-base font-semibold"},We={class:"rounded-md bg-gray-50 p-3"},ze={class:"mt-1"},Qe={class:"text-base font-semibold"},Ye={class:"mt-6 text-right"},Z="breakeven",ts={__name:"BreakEvenCalculatorView",setup(st){const R=b([]),w=b([]),B=b([]),m=b([]),T=b([]),U=b(1e4),i=b(null),F=b(!1),x=b(null),d=b(!1),h=b(null),L=b(!0),k=b(null),j=b(null),ot=b(null),pt=tt(()=>{if(k.value===null||!i.value)return[];const o=i.value.projections[k.value];return o?i.value.productDetails.map(e=>{const n=o.units*(e.salesMix/i.value.totalMixRatio);return{name:e.name,units:Math.ceil(n)}}):[]});async function O(){try{L.value=!0;const[o,e,n,s]=await Promise.all([P.analysisGroups.where("groupType").equals(Z).toArray(),P.products.toArray(),P.recipes.toArray(),P.ingredients.toArray()]);R.value=o,w.value=e,B.value=n,T.value=n.filter(u=>u.isSubRecipe),m.value=s}catch(o){console.error("Failed to fetch data:",o)}finally{L.value=!1}}It(O);const mt=tt(()=>w.value.map(o=>({value:o.id,label:`${o.name} (${o.price} บาท)`}))),S=b([{productId:null,salesMix:null}]);ut(S,o=>{i.value=null,o.forEach(e=>{if(e.productId&&!e.price){const n=w.value.find(s=>s.id===e.productId);n&&(e.price=n.price)}})},{deep:!0});function vt(){S.value.push({productId:null,salesMix:null,price:null})}function bt(o){S.value.splice(o,1)}function xt(o){S.value=JSON.parse(JSON.stringify(o.products)),j.value={id:o.id,name:o.name},y.fire({toast:!0,position:"top-end",icon:"success",title:`โหลดข้อมูลกลุ่ม "${o.name}" แล้ว`,showConfirmButton:!1,timer:1e3}),X(()=>{ot.value?.scrollIntoView({behavior:"smooth"})})}function gt(){S.value=[{productId:null,monthlySales:null}],i.value=null,j.value=null}async function ft(){const{value:o}=await y.fire({title:"บันทึกกลุ่มวิเคราะห์",input:"text",inputLabel:"ชื่อกลุ่ม",inputPlaceholder:"ใส่ชื่อกลุ่มที่ต้องการบันทึก",showCancelButton:!0,confirmButtonText:"บันทึก",cancelButtonText:"ยกเลิก"});if(o){const n=JSON.parse(JSON.stringify(S.value)).filter(s=>s.productId&&s.salesMix>0);if(n.length>0){const s={name:o,products:n,groupType:Z};await P.analysisGroups.add(s),await O(),y.fire({toast:!0,position:"top-end",icon:"success",title:"บันทึกกลุ่มสำเร็จ",showConfirmButton:!1,timer:3e3})}else y.fire("เกิดข้อผิดพลาด","กรุณาเลือกสินค้าและใส่สัดส่วนการขาย","error")}}async function yt(){const o=j.value?j.value.name:" (คำนวณชั่วคราว)",e=S.value.map(s=>{const u=w.value.find(v=>v.id===s.productId);return!u||!s.salesMix?null:{...u,salesMix:s.salesMix}}).filter(Boolean);if(e.length===0){y.fire("ข้อมูลไม่ครบถ้วน","กรุณาเลือกสินค้าและใส่สัดส่วนการขาย","warning");return}await ht({name:o,products:e}),await X(),h.value?.scrollIntoView({behavior:"smooth"})}async function ht(o){if(i.value=null,!o||!o.products)return;const e=o.products.map(c=>({...w.value.find(D=>D.id===c.productId),...c})).filter(c=>c.id&&c.salesMix&&c.price);if(e.length===0){y.fire("ข้อมูลไม่ครบถ้วน","กรุณาเลือกสินค้า, ใส่สัดส่วน และราคาขายให้ครบ","warning");return}let n=0,s=0,u=0;const v=[];for(const c of e){const _=B.value.find(E=>E.id===c.recipeId);if(!_)continue;const D=await nt(_,1),Y=_.ingredientsList.reduce((E,K)=>E+Number(K.quantity||0),0)||1,lt=D.reduce((E,K)=>E+K.totalCost,0)/Y*Number(c.weight),H=Number(c.price),it=H-lt,J=Number(c.salesMix);n+=J,s+=it*J,u+=H*J,v.push({name:c.name,variableCost:lt,sellingPrice:H,contributionMargin:it,salesMix:J,productId:c.id})}if(n===0||s<=0){y.fire("คำนวณไม่ได้","ข้อมูลไม่ถูกต้อง หรือกำไรส่วนเกินติดลบ","warning");return}const $=s/n,p=u/n,g=Number(U.value||0)/$,V=g*p,A=v.map(c=>{const _=g*(c.salesMix/n);return{name:c.name,units:Math.ceil(_)}}),f=[],Q=Math.ceil(g);for(let c=0;c<=5;c++){const _=Q+50*c,D=_*p,Y=_*$-Number(U.value||0);f.push({units:_,revenue:D,profit:Y})}i.value={groupName:o.name,productDetails:v,weightedAverageCm:$,totalWeightedCm:s,totalMixRatio:n,breakEvenPointUnits:Math.ceil(g),breakEvenPointRevenue:V,breakEvenUnitsByProduct:A,projections:f},await X(),h.value?.scrollIntoView({behavior:"smooth"})}async function nt(o,e){const n=new Map;if(!o.ingredientsList)return[];for(const s of o.ingredientsList){if(!s.quantity||typeof s.quantity!="number"||s.quantity<=0)continue;const u=Number(s.quantity)*e,v=Number(s.yield||100)/100,$=u/v;if(s.itemType==="ingredient"){const p=m.value.find(g=>g.id===s.itemId);if(p){let g=0;if(s.costByWholeUnit&&p.purchaseUnit.toLowerCase()!=="กรัม"){const V=Number(p.standardWeightInGrams||1),A=Math.ceil($/V),f=Number(p.purchasePrice)/Number(p.purchaseQuantity);g=A*f}else g=$*Number(p.costPerGram||0);n.has(p.id)?n.get(p.id).totalCost+=g:n.set(p.id,{id:p.id,name:p.name,totalCost:g})}}else if(s.itemType==="recipe"){const p=T.value.find(g=>g.id===s.itemId);if(p){const g=p.ingredientsList.reduce((f,Q)=>f+Number(Q.quantity||0),0)||1,V=$/g;(await nt(p,V)).forEach(f=>{n.has(f.id)?n.get(f.id).totalCost+=f.totalCost:n.set(f.id,f)})}}}return Array.from(n.values())}function kt(o){return w.value.find(e=>e.id===o)?.name||"N/A"}function wt(o){k.value===o?k.value=null:k.value=o}function _t(){x.value={name:"",products:[{productId:null,salesMix:null}]},F.value=!0}function Ct(o){x.value={...JSON.parse(JSON.stringify(o))},F.value=!0}function z(){F.value=!1,x.value=null}async function Mt(o){const e={...JSON.parse(JSON.stringify(o)),groupType:Z};e.id?await P.analysisGroups.update(e.id,e):await P.analysisGroups.add(e),z(),await O(),y.fire({toast:!0,position:"top-end",icon:"success",title:"บันทึกกลุ่มสำเร็จ",showConfirmButton:!1,timer:3e3})}async function St(o,e){(await y.fire({title:`ลบกลุ่ม "${e}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ใช่, ลบเลย",cancelButtonText:"ยกเลิก"})).isConfirmed&&(await P.analysisGroups.delete(o),await O(),y.fire({toast:!0,position:"top-end",icon:"success",title:"ลบสำเร็จ",showConfirmButton:!1,timer:3e3}))}return(o,e)=>{const n=Ut("font-awesome-icon");return a(),r("div",null,[L.value?(a(),r("div",Jt,e[4]||(e[4]=[t("p",null,"กำลังโหลดข้อมูล...",-1)]))):(a(),r("div",qt,[t("div",{ref_key:"liveCalculatorSection",ref:ot,class:"mb-6 rounded-lg bg-white p-4 shadow-md dark:bg-gray-700"},[e[9]||(e[9]=t("h1",{class:"mb-6 text-3xl font-bold"},"คำนวณหาจุดคุ้มทุน",-1)),t("div",Wt,[t("div",zt,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium"},"ต้นทุนคงที่ทั้งหมด/เดือน (บาท)",-1)),q(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>U.value=s),type:"number",class:"mt-1 w-full rounded-md border p-2 md:w-1/2 dark:bg-slate-100 dark:text-gray-600"},null,512),[[W,U.value,void 0,{number:!0}]])]),e[8]||(e[8]=t("h4",{class:"mb-2 font-semibold"},"รายการสินค้า",-1)),t("div",Qt,[(a(!0),r(M,null,N(S.value,(s,u)=>(a(),r("div",{key:u,class:"rounded-lg bg-gray-50 p-3 dark:bg-gray-400"},[t("div",Yt,[t("div",Ht,[e[6]||(e[6]=t("label",{class:"block text-xs font-medium text-gray-600"},"สินค้า",-1)),I(et(ct),{modelValue:s.productId,"onUpdate:modelValue":v=>s.productId=v,options:mt.value,placeholder:"เลือกสินค้า",class:"mt-1 dark:bg-slate-100 dark:text-gray-600"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",Kt,[e[7]||(e[7]=t("label",{class:"block text-xs font-medium text-gray-600"},"สัดส่วนการขาย (%)",-1)),q(t("input",{"onUpdate:modelValue":v=>s.salesMix=v,type:"number",placeholder:"สัดส่วน",class:"mt-1 w-24 rounded-md border p-2 dark:text-gray-600"},null,8,Xt),[[W,s.salesMix,void 0,{number:!0}]])]),t("button",{onClick:v=>bt(u),type:"button",class:"flex h-5 w-5 flex-shrink-0 items-center justify-center py-5 text-red-500 dark:text-red-400"},[I(n,{icon:"trash"})],8,Zt)])]))),128))]),t("div",{class:"mt-4 flex items-center space-x-4"},[t("button",{onClick:vt,type:"button",class:"dark:text-primary-dark font-semibold text-primary"}," + เพิ่มสินค้า ")]),t("div",{class:"mt-4 flex justify-end space-x-2 border-t pt-4"},[t("button",{onClick:gt,class:"rounded-lg bg-gray-300 px-4 py-2 font-bold text-gray-800"}," clear "),t("button",{onClick:ft,class:"rounded-lg border border-blue-500 px-4 py-2 text-blue-500 transition hover:bg-blue-500 hover:text-white"}," บันทึกเป็นกลุ่มใหม่ "),t("button",{onClick:yt,class:"dark:bg-primary-dark rounded-lg bg-primary px-4 py-2 text-white dark:text-gray-600"}," คำนวณ ")])])],512),t("div",te,[t("div",{class:"mb-4 flex items-center justify-between"},[e[10]||(e[10]=t("h2",{class:"text-2xl font-semibold"},"กลุ่มที่บันทึกไว้",-1)),t("button",{onClick:_t,class:"rounded-md bg-gray-200 px-4 py-2 text-sm hover:bg-gray-300 dark:text-gray-600"}," + สร้างกลุ่มใหม่ ")]),t("table",ee,[t("tbody",null,[R.value.length===0?(a(),r("tr",se,e[11]||(e[11]=[t("td",{class:"py-4 text-center text-gray-500"}," ยังไม่มีกลุ่มที่บันทึกไว้... ",-1)]))):G("",!0),(a(!0),r(M,null,N(R.value,s=>(a(),r("tr",{key:s.id,class:"border-b"},[t("td",oe,[t("p",ne,l(s.name),1),t("p",le," ประกอบด้วย: "+l(s.products.map(u=>kt(u.productId)).join(", ")),1)]),t("td",ie,[t("div",ae,[t("button",{onClick:u=>xt(s),class:"rounded bg-gray-200 px-3 py-1 text-sm hover:bg-gray-300"}," โหลด ",8,re),t("div",de,[t("button",{onClick:u=>Ct(s),class:"text-gray-500 hover:text-secondary"},[I(n,{icon:"pencil"})],8,ue),t("button",{onClick:u=>St(s.id,s.name),class:"text-gray-500 hover:text-primary"},[I(n,{icon:"trash"})],8,ce)])])])]))),128))])])]),i.value?(a(),r("div",{key:0,ref_key:"resultsSection",ref:h,class:"mt-6 space-y-6 rounded-lg bg-white p-6 shadow-md dark:bg-gray-700"},[t("div",pe,[t("h2",me,[e[12]||(e[12]=C(" ผลการคำนวณ:")),e[13]||(e[13]=t("br",null,null,-1)),t("span",ve,l(i.value.groupName),1)]),t("button",{onClick:e[1]||(e[1]=s=>d.value=!0),class:"text-blue-500 hover:text-blue-700"},[I(n,{icon:"circle-info"}),e[14]||(e[14]=t("span",{class:"ml-1 text-sm"},"ดูขั้นตอนการคำนวณ",-1))])]),t("div",null,[e[16]||(e[16]=t("h3",{class:"mb-2 font-semibold"},"รายละเอียดต้นทุนและกำไรต่อหน่วย",-1)),t("table",be,[e[15]||(e[15]=t("thead",{class:"bg-gray-100 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left"},"สินค้า"),t("th",{class:"px-3 py-2 text-right"},"ราคาขาย"),t("th",{class:"px-3 py-2 text-right"},"ต้นทุนผันแปร"),t("th",{class:"px-3 py-2 text-right"},"กำไรส่วนเกิน")])],-1)),t("tbody",null,[(a(!0),r(M,null,N(i.value.productDetails,s=>(a(),r("tr",{key:s.productId,class:"border-b dark:border-b-gray-600"},[t("td",xe,l(s.name),1),t("td",ge,l(s.sellingPrice.toFixed(2)),1),t("td",fe,l(s.variableCost.toFixed(2)),1),t("td",ye,l(s.contributionMargin.toFixed(2)),1)]))),128))])])]),t("div",he,[t("div",ke,[e[17]||(e[17]=t("p",{class:"text-sm text-gray-600"},"ต้องขายทั้งหมด",-1)),t("p",we,l(i.value.breakEvenPointUnits.toLocaleString()),1),e[18]||(e[18]=t("p",{class:"text-sm text-gray-600"},"หน่วยผสม (Mixed Units)",-1))]),t("div",_e,[e[19]||(e[19]=t("p",{class:"text-sm text-gray-600"},"คิดเป็นยอดขาย",-1)),t("p",Ce,l(i.value.breakEvenPointRevenue.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),e[20]||(e[20]=t("p",{class:"text-sm text-gray-600"},"บาท ถึงจะคุ้มทุน",-1))])]),e[24]||(e[24]=t("h3",{class:"mb-2 font-semibold"},"จำนวนที่ต้องขาย (โดยประมาณ)",-1)),t("ul",Me,[(a(!0),r(M,null,N(i.value.breakEvenUnitsByProduct,s=>(a(),r("li",{key:s.name},l(s.name)+": "+l(s.units.toLocaleString())+" ชิ้น ",1))),128))]),e[25]||(e[25]=t("h3",{class:"mb-2 font-semibold"},"ตารางคาดการณ์กำไร",-1)),t("table",Se,[e[23]||(e[23]=t("thead",{class:"bg-gray-100 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-2 text-right"},"จำนวนขายรวม (หน่วยผสม)"),t("th",{class:"px-4 py-2 text-right"},"ยอดขาย (บาท)"),t("th",{class:"px-4 py-2 text-right"},"กำไร/ขาดทุน (บาท)")])],-1)),t("tbody",null,[(a(!0),r(M,null,N(i.value.projections,(s,u)=>(a(),r(M,{key:u},[t("tr",{onClick:v=>wt(u),class:"cursor-pointer border-b hover:bg-gray-100 dark:border-b-gray-500 hover:dark:bg-slate-300 hover:dark:text-gray-600"},[t("td",Ne,l(s.units.toLocaleString()),1),t("td",Ie,l(s.revenue.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),t("td",{class:$t(["px-4 py-2 text-right",s.profit<0?"text-red-500":"text-green-600"])},l(s.profit.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),3)],8,Pe),k.value===u?(a(),r("tr",Ue,[t("td",$e,[e[22]||(e[22]=t("p",{class:"mb-2 text-sm font-semibold"}," รายละเอียดจำนวนขายโดยประมาณ: ",-1)),t("ul",Fe,[(a(!0),r(M,null,N(pt.value,v=>(a(),r("li",{key:v.name},[C(l(v.name)+": ",1),t("span",Le,l(v.units.toLocaleString()),1),e[21]||(e[21]=C(" ชิ้น "))]))),128))])])])):G("",!0)],64))),128))])])],512)):G("",!0),F.value?(a(),at(dt,{key:1,onClose:z,size:"large"},{default:rt(()=>[I(At,{"initial-data":x.value,"available-products":w.value,onSave:Mt,onCancel:z},null,8,["initial-data","available-products"])]),_:1})):G("",!0),d.value?(a(),at(dt,{key:2,onClose:e[3]||(e[3]=s=>d.value=!1),size:"large"},{default:rt(()=>[i.value?(a(),r("div",Ge,[e[37]||(e[37]=t("h3",{class:"mb-4 text-2xl font-semibold"},"ขั้นตอนการคำนวณจุดคุ้มทุน",-1)),t("div",Re,[t("div",Be,[e[26]||(e[26]=t("p",{class:"text-base font-semibold"}," 1. หากำไรส่วนเกิน (Contribution Margin) ต่อหน่วย ",-1)),e[27]||(e[27]=t("p",{class:"mb-2 text-xs text-gray-500"}," สูตร: ราคาขาย - ต้นทุนผันแปร ",-1)),t("table",Ve,[t("tbody",null,[(a(!0),r(M,null,N(i.value.productDetails,s=>(a(),r("tr",{key:s.productId},[t("td",De,l(s.name),1),t("td",Ee,l(s.sellingPrice.toFixed(2))+" - "+l(s.variableCost.toFixed(2)),1),t("td",Te," = "+l(s.contributionMargin.toFixed(2))+" บาท ",1)]))),128))])])]),t("div",je,[e[29]||(e[29]=t("p",{class:"text-base font-semibold"}," 2. หากำไรส่วนเกินถัวเฉลี่ย (Weighted Avg. CM) ",-1)),e[30]||(e[30]=t("p",{class:"mb-2 text-xs text-gray-500"}," สูตร: (กำไรส่วนเกิน x สัดส่วน) รวมกัน / สัดส่วนรวม ",-1)),t("div",null,[t("p",null," กำไรส่วนเกินถ่วงน้ำหนักรวม: "+l(i.value.totalWeightedCm.toFixed(2)),1),t("p",null," สัดส่วนรวม: "+l(i.value.totalMixRatio),1),t("p",Oe,[C(l(i.value.totalWeightedCm.toFixed(2))+" / "+l(i.value.totalMixRatio)+" = ",1),t("span",Ae,l(i.value.weightedAverageCm.toFixed(2)),1),e[28]||(e[28]=C(" บาท/หน่วย "))])])]),t("div",Je,[e[32]||(e[32]=t("p",{class:"text-base font-semibold"},"3. หาจุดคุ้มทุน (หน่วย)",-1)),e[33]||(e[33]=t("p",{class:"mb-2 text-xs text-gray-500"}," สูตร: ต้นทุนคงที่ทั้งหมด / กำไรส่วนเกินถัวเฉลี่ย ",-1)),t("p",null,[C(l(Number(U.value).toLocaleString())+" / "+l(i.value.weightedAverageCm.toFixed(2))+" = ",1),t("span",qe,l(i.value.breakEvenPointUnits.toLocaleString()),1),e[31]||(e[31]=C(" หน่วยผสม "))])]),t("div",We,[e[36]||(e[36]=t("p",{class:"text-base font-semibold"},"4. สรุปยอดขาย ณ จุดคุ้มทุน",-1)),t("p",ze,[e[34]||(e[34]=C(" รวมเป็นยอดขาย ")),t("span",Qe,l(i.value.breakEvenPointRevenue.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),e[35]||(e[35]=C(" บาท "))])])]),t("div",Ye,[t("button",{onClick:e[2]||(e[2]=s=>d.value=!1),class:"rounded-md bg-primary px-4 py-2 text-white"}," ปิด ")])])):G("",!0)]),_:1})):G("",!0)]))])}}};export{ts as default};
