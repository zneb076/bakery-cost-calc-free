import{r as b,c as h,w as D,a as p,o as i,b as e,t as S,d as N,i as w,j as m,v as y,p as M,f as $,k as B,q as W,x as Y,n as _,g as Q,h as T,l as F,F as L,e as j,m as A,_ as E}from"./index-DWefaeUi.js";import{S as c,d as V}from"./sweetalert2.esm.all-BdfwKlh3.js";import{_ as K}from"./CustomAutocomplete-BJJJ4X7m.js";const O={class:"p-6"},q={class:"mb-4 text-2xl font-semibold"},J={class:"space-y-4"},R={class:"grid grid-cols-2 gap-4"},z={key:0,class:"rounded-md bg-blue-50 p-3"},H={class:"block text-sm font-medium text-blue-800"},X={class:"mt-4 border-t pt-4"},Z={class:"mt-4"},ee={class:"flex items-center"},te=["disabled"],se={class:"flex justify-end space-x-3 rounded-b-lg bg-gray-50 px-6 py-3"},ne={__name:"IngredientForm",props:{initialData:{type:Object,default:()=>({name:"",purchaseUnit:"กรัม",purchaseQuantity:null,purchasePrice:null,defaultYield:100,costByWholeUnit:!1,standardWeightInGrams:null})},existingNames:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(k,{emit:v}){const u=k,d=v,n=b({}),I=b(null),C=h(()=>!!u.initialData.id),f=h(()=>n.value.purchaseUnit&&n.value.purchaseUnit.trim().toLowerCase()!=="กรัม"),U=h(()=>!n.value.purchaseUnit||n.value.purchaseUnit.trim().toLowerCase()==="กรัม");D(()=>u.initialData,o=>{n.value={...o},n.value.defaultYield==null&&(n.value.defaultYield=100)},{immediate:!0,deep:!0});function x(o){_(()=>{document.getElementById(o)?.focus()})}function g(){const{name:o,purchaseUnit:t,purchaseQuantity:s,purchasePrice:l,standardWeightInGrams:r}=n.value;if(!o||!t||!s||!l){c.fire({icon:"error",title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกข้อมูลหลักให้ครบ"});return}let a=0;if(f.value){if(!r||r<=0){c.fire({icon:"error",title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกน้ำหนักมาตรฐานเป็นกรัม"});return}const P=s*r;a=l/P}else a=l/s;const G={...n.value,costPerGram:a};d("save",G)}return(o,t)=>(i(),p("form",{onSubmit:$(g,["prevent"])},[e("div",O,[e("h3",q,S(k.initialData.id?"แก้ไขวัตถุดิบ":"เพิ่มวัตถุดิบใหม่"),1),e("div",J,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อวัตถุดิบ",-1)),w(K,{ref_key:"autocompleteRef",ref:I,modelValue:n.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.name=s),options:k.existingNames,disabled:C.value,creatable:!0,"show-all-on-focus":!1,placeholder:"ชื่อวัตถุดิบ",onSelectionMade:t[1]||(t[1]=s=>x("price-input")),class:"mt-1"},null,8,["modelValue","options","disabled"])]),e("div",R,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium"},"ราคาที่ซื้อ (บาท)",-1)),m(e("input",{id:"price-input","onUpdate:modelValue":t[2]||(t[2]=s=>n.value.purchasePrice=s),onKeydown:t[3]||(t[3]=M($(s=>x("quantity-input"),["prevent"]),["enter"])),type:"number",step:"0.01",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,n.value.purchasePrice,void 0,{number:!0}]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium"},"จำนวนที่ซื้อ",-1)),m(e("input",{id:"quantity-input","onUpdate:modelValue":t[4]||(t[4]=s=>n.value.purchaseQuantity=s),onKeydown:t[5]||(t[5]=M($(s=>x("unit-input"),["prevent"]),["enter"])),type:"number",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,n.value.purchaseQuantity,void 0,{number:!0}]])])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium"},"หน่วยที่ซื้อ",-1)),m(e("input",{id:"unit-input","onUpdate:modelValue":t[6]||(t[6]=s=>n.value.purchaseUnit=s),onKeydown:t[7]||(t[7]=M($(()=>{},["prevent"]),["enter"])),type:"text",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,n.value.purchaseUnit]])]),f.value?(i(),p("div",z,[e("label",H,"น้ำหนักเป็นกรัม ต่อ 1 "+S(n.value.purchaseUnit),1),t[16]||(t[16]=e("p",{class:"mb-1 text-xs text-gray-500"},"เช่น ไข่ 1 ฟองหนัก 50 กรัม",-1)),m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>n.value.standardWeightInGrams=s),type:"number",class:"mt-1 block w-full rounded-md border p-2"},null,512),[[y,n.value.standardWeightInGrams,void 0,{number:!0}]])])):N("",!0),e("div",X,[t[20]||(t[20]=e("h4",{class:"mb-2 font-semibold text-gray-800"}," การตั้งค่าต้นทุน (ทางเลือก) ",-1)),t[21]||(t[21]=e("p",{class:"mb-4 text-xs text-gray-500"}," ส่วนนี้เป็นค่าที่ตั้งไว้ล่วงหน้าเพื่อการคำนวณที่แม่นยำขึ้น หากไม่ต้องการใช้งาน สามารถข้ามไปได้เลย ",-1)),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700"},"1. Yield เริ่มต้น (%)",-1)),m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>n.value.defaultYield=s),type:"number",min:"0",max:"100",class:"mt-1 w-full rounded-md border p-2"},null,512),[[y,n.value.defaultYield,void 0,{number:!0}]]),t[18]||(t[18]=e("p",{class:"mt-1 text-xs text-gray-500"},[B(" คือเปอร์เซ็นต์ของวัตถุดิบที่ใช้ได้จริงหลังการเตรียม เช่น กล้วยหอมซื้อมา 100g ปอกเปลือกแล้วเหลือเนื้อกล้วยที่ใช้ได้ 80g ให้ใส่ Yield เป็น 80 "),e("br"),e("span",{class:"text-green-700"},[B("วิธีคิด "),e("br"),B("(น้ำหนักที่เหลือ x 100) / น้ำหนักที่ซื้อมา "),e("br"),B("= ค่า Yield ที่เอาไปกรอก")])],-1))]),t[22]||(t[22]=e("div",{class:"mt-6 border-t"},null,-1)),e("div",Z,[e("div",ee,[m(e("input",{id:"costByWholeUnit","onUpdate:modelValue":t[10]||(t[10]=s=>n.value.costByWholeUnit=s),disabled:U.value,type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-primary disabled:bg-gray-200"},null,8,te),[[W,n.value.costByWholeUnit]]),e("label",{for:"costByWholeUnit",class:Y(["ml-2 block text-sm",U.value?"text-gray-400":"text-gray-900"])}," 2. คิดต้นทุนเต็มหน่วยเสมอ ",2)]),t[19]||(t[19]=e("p",{class:"ml-6 mt-1 text-xs text-gray-500"}," ใช้สำหรับวัตถุดิบที่ต้องใช้ทั้งหน่วยเสมอ เช่น ไข่ไก่ 1 ฟอง (60กรัม) แต่ในสูตรเราใช้แค่ 25กรัม ที่เหลือเก็บไม่ได้ต้องทิ้ง เราก็จะติ้กช่องนี้ ",-1))])])])]),e("div",se,[e("button",{type:"button",onClick:t[11]||(t[11]=s=>d("cancel")),class:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"}," ยกเลิก "),t[23]||(t[23]=e("button",{type:"submit",class:"rounded-md border border-transparent bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-opacity-90"}," บันทึก ",-1))])],32))}},le={class:"rounded-lg bg-white p-4 shadow-md"},ae={class:"overflow-x-auto"},oe={class:"relative mb-4 w-full md:w-64"},re={class:"min-w-full bg-white"},ie={key:0},ue={class:"px-4 py-2"},de={class:"px-4 py-2 text-right font-semibold text-primary"},me={class:"px-4 py-2 text-center"},pe={class:"space-x-3"},ce=["onClick"],ve=["onClick"],xe={__name:"IngredientManagementView",setup(k){const v=b([]),u=b(!1),d=b(null),n=b(""),I=h(()=>v.value.map(s=>s.name)),C=h(()=>n.value?v.value.filter(s=>s.name.toLowerCase().includes(n.value.toLowerCase())):v.value);async function f(){v.value=await V.ingredients.orderBy("name").toArray()}function U(){d.value={name:"",purchaseUnit:"กรัม",purchaseQuantity:null,purchasePrice:null},u.value=!0}function x(s){d.value={...s},u.value=!0}function g(){u.value=!1,d.value=null}async function o(s){try{const l=JSON.parse(JSON.stringify(s));l.id?await V.ingredients.update(l.id,l):await V.ingredients.add(l),c.fire({toast:!0,position:"top-end",icon:"success",title:"บันทึกข้อมูลสำเร็จ",showConfirmButton:!1,timer:1e3}),g(),await f()}catch(l){console.error("Save failed:",l),c.fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลได้","error")}}async function t(s,l){if((await c.fire({title:"คุณแน่ใจหรือไม่?",text:`คุณต้องการลบ "${l}" ใช่ไหม? การกระทำนี้ไม่สามารถย้อนกลับได้!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ลบเลย!",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await V.ingredients.delete(s),await f(),await c.fire({toast:!0,position:"top-end",icon:"success",title:"ลบข้อมูลสำเร็จ",showConfirmButton:!1,timer:1e3,timerProgressBar:!0})}catch(a){console.error("Failed to delete ingredient:",a),await c.fire("เกิดข้อผิดพลาด!","ไม่สามารถลบข้อมูลได้","error")}}return Q(f),(s,l)=>{const r=F("font-awesome-icon");return i(),p("div",null,[e("div",le,[e("div",ae,[e("div",{class:"mb-6 flex items-center justify-between"},[l[2]||(l[2]=e("h1",{class:"text-2xl font-bold"},"วัตถุดิบ",-1)),e("button",{onClick:U,class:"rounded-lg bg-primary px-4 py-2 text-white transition-opacity hover:bg-opacity-90"}," + เพิ่มวัตถุดิบใหม่ ")]),e("div",oe,[m(e("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=a=>n.value=a),placeholder:"ค้นหาวัตถุดิบ...",class:"w-full rounded-md border border-gray-300 px-3 py-2 pr-10"},null,512),[[y,n.value]]),n.value?(i(),p("button",{key:0,onClick:l[1]||(l[1]=a=>n.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700"},[w(r,{icon:"xmark"})])):N("",!0)]),e("table",re,[l[4]||(l[4]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"ชื่อวัตถุดิบ"),e("th",{class:"px-4 py-2 text-right font-semibold text-primary"}," ราคาต่อกรัม (บาท) "),e("th",{class:"px-4 py-2 text-center"},"จัดการ")])],-1)),e("tbody",null,[C.value.length===0?(i(),p("tr",ie,l[3]||(l[3]=[e("td",{colspan:"4",class:"py-4 text-center text-gray-500"}," ไม่พบวัตถุดิบที่ตรงกัน... ",-1)]))):N("",!0),(i(!0),p(L,null,j(C.value,a=>(i(),p("tr",{key:a.id,class:"border-b hover:bg-gray-50"},[e("td",ue,S(a.name),1),e("td",de,S(a.costPerGram?a.costPerGram.toFixed(2):"N/A"),1),e("td",me,[e("div",pe,[e("button",{onClick:G=>x(a),class:"text-gray-500 hover:text-secondary"},[w(r,{icon:"pencil"})],8,ce),e("button",{onClick:G=>t(a.id,a.name),class:"text-gray-500 hover:text-primary"},[w(r,{icon:"trash"})],8,ve)])])]))),128))])])])]),u.value?(i(),T(E,{key:0,onClose:g},{default:A(()=>[w(ne,{"initial-data":d.value,"existing-names":I.value,onSave:o,onCancel:g},null,8,["initial-data","existing-names"])]),_:1})):N("",!0)])}}};export{xe as default};
