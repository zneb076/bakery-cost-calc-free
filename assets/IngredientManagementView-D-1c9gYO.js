import{r as v,c as w,w as D,a as p,o as i,b as t,t as S,d as N,i as k,j as m,v as b,p as M,f as $,k as B,q as W,x as Y,n as _,g as Q,h as T,l as F,F as L,e as j,m as A,_ as E}from"./index-XM_L99Nl.js";import{S as c,d as V}from"./sweetalert2.esm.all-BdfwKlh3.js";import{_ as K}from"./CustomAutocomplete-D9WIcL0E.js";const O={class:"p-6 dark:bg-gray-700"},q={class:"mb-4 text-2xl font-semibold"},J={class:"space-y-4"},R={class:"grid grid-cols-2 gap-4"},z={key:0,class:"rounded-md bg-blue-50 p-3"},H={class:"block text-sm font-medium text-blue-800"},X={class:"mt-4 border-t pt-4"},Z={class:"mt-4"},tt={class:"flex items-center"},et=["disabled"],at={class:"flex justify-end space-x-3 rounded-b-lg bg-gray-50 px-6 py-3 dark:bg-gray-800"},rt={__name:"IngredientForm",props:{initialData:{type:Object,default:()=>({name:"",purchaseUnit:"กรัม",purchaseQuantity:null,purchasePrice:null,defaultYield:100,costByWholeUnit:!1,standardWeightInGrams:null})},existingNames:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(h,{emit:y}){const d=h,u=y,r=v({}),I=v(null),C=w(()=>!!d.initialData.id),x=w(()=>r.value.purchaseUnit&&r.value.purchaseUnit.trim().toLowerCase()!=="กรัม"),U=w(()=>!r.value.purchaseUnit||r.value.purchaseUnit.trim().toLowerCase()==="กรัม");D(()=>d.initialData,n=>{r.value={...n},r.value.defaultYield==null&&(r.value.defaultYield=100)},{immediate:!0,deep:!0});function g(n){_(()=>{document.getElementById(n)?.focus()})}function f(){const{name:n,purchaseUnit:e,purchaseQuantity:a,purchasePrice:s,standardWeightInGrams:o}=r.value;if(!n||!e||!a||!s){c.fire({icon:"error",title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกข้อมูลหลักให้ครบ"});return}let l=0;if(x.value){if(!o||o<=0){c.fire({icon:"error",title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกน้ำหนักมาตรฐานเป็นกรัม"});return}const P=a*o;l=s/P}else l=s/a;const G={...r.value,costPerGram:l};u("save",G)}return(n,e)=>(i(),p("form",{onSubmit:$(f,["prevent"])},[t("div",O,[t("h3",q,S(h.initialData.id?"แก้ไขวัตถุดิบ":"เพิ่มวัตถุดิบใหม่"),1),t("div",J,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-200"},"ชื่อวัตถุดิบ",-1)),k(K,{ref_key:"autocompleteRef",ref:I,modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.name=a),options:h.existingNames,disabled:C.value,creatable:!0,"show-all-on-focus":!1,placeholder:"ชื่อวัตถุดิบ",onSelectionMade:e[1]||(e[1]=a=>g("price-input")),class:"mt-1"},null,8,["modelValue","options","disabled"])]),t("div",R,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium"},"ราคาที่ซื้อ (บาท)",-1)),m(t("input",{id:"price-input","onUpdate:modelValue":e[2]||(e[2]=a=>r.value.purchasePrice=a),onKeydown:e[3]||(e[3]=M($(a=>g("quantity-input"),["prevent"]),["enter"])),type:"number",step:"0.01",class:"mt-1 w-full rounded-md border p-2 dark:bg-gray-300 dark:text-gray-600"},null,544),[[b,r.value.purchasePrice,void 0,{number:!0}]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium"},"จำนวนที่ซื้อ",-1)),m(t("input",{id:"quantity-input","onUpdate:modelValue":e[4]||(e[4]=a=>r.value.purchaseQuantity=a),onKeydown:e[5]||(e[5]=M($(a=>g("unit-input"),["prevent"]),["enter"])),type:"number",class:"mt-1 w-full rounded-md border p-2 dark:bg-gray-300 dark:text-gray-600"},null,544),[[b,r.value.purchaseQuantity,void 0,{number:!0}]])])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium"},"หน่วยที่ซื้อ",-1)),m(t("input",{id:"unit-input","onUpdate:modelValue":e[6]||(e[6]=a=>r.value.purchaseUnit=a),onKeydown:e[7]||(e[7]=M($(()=>{},["prevent"]),["enter"])),type:"text",class:"mt-1 w-full rounded-md border p-2 dark:bg-gray-300 dark:text-slate-500"},null,544),[[b,r.value.purchaseUnit]])]),x.value?(i(),p("div",z,[t("label",H,"น้ำหนักเป็นกรัม ต่อ 1 "+S(r.value.purchaseUnit),1),e[16]||(e[16]=t("p",{class:"mb-1 text-xs text-gray-500"},"เช่น ไข่ 1 ฟองหนัก 50 กรัม",-1)),m(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>r.value.standardWeightInGrams=a),type:"number",class:"mt-1 block w-full rounded-md border p-2"},null,512),[[b,r.value.standardWeightInGrams,void 0,{number:!0}]])])):N("",!0),t("div",X,[e[20]||(e[20]=t("h4",{class:"mb-2 font-semibold text-gray-800 dark:text-slate-300"}," การตั้งค่าต้นทุน (ทางเลือก) ",-1)),e[21]||(e[21]=t("p",{class:"mb-4 text-xs text-gray-500 dark:text-slate-300"}," ส่วนนี้เป็นค่าที่ตั้งไว้ล่วงหน้าเพื่อการคำนวณที่แม่นยำขึ้น หากไม่ต้องการใช้งาน สามารถข้ามไปได้เลย ",-1)),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700"},"1. Yield เริ่มต้น (%)",-1)),m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.defaultYield=a),type:"number",min:"0",max:"100",class:"mt-1 w-full rounded-md border p-2 dark:bg-gray-300 dark:text-gray-600"},null,512),[[b,r.value.defaultYield,void 0,{number:!0}]]),e[18]||(e[18]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-slate-300"},[B(" คือเปอร์เซ็นต์ของวัตถุดิบที่ใช้ได้จริงหลังการเตรียม เช่น กล้วยหอมซื้อมา 100g ปอกเปลือกแล้วเหลือเนื้อกล้วยที่ใช้ได้ 80g ให้ใส่ Yield เป็น 80 "),t("br"),t("span",{class:"text-green-700 dark:text-slate-300"},[B("วิธีคิด "),t("br"),B("(น้ำหนักที่เหลือ x 100) / น้ำหนักที่ซื้อมา "),t("br"),B("= ค่า Yield ที่เอาไปกรอก")])],-1))]),e[22]||(e[22]=t("div",{class:"mt-6 border-t"},null,-1)),t("div",Z,[t("div",tt,[m(t("input",{id:"costByWholeUnit","onUpdate:modelValue":e[10]||(e[10]=a=>r.value.costByWholeUnit=a),disabled:U.value,type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-primary disabled:bg-gray-200"},null,8,et),[[W,r.value.costByWholeUnit]]),t("label",{for:"costByWholeUnit",class:Y(["ml-2 block text-sm",U.value?"text-gray-400":"text-gray-900 dark:text-slate-200"])}," 2. คิดต้นทุนเต็มหน่วยเสมอ ",2)]),e[19]||(e[19]=t("p",{class:"ml-6 mt-1 text-xs text-gray-500 dark:text-slate-300"}," ใช้สำหรับวัตถุดิบที่ต้องใช้ทั้งหน่วยเสมอ เช่น ไข่ไก่ 1 ฟอง (60กรัม) แต่ในสูตรเราใช้แค่ 25กรัม ที่เหลือเก็บไม่ได้ต้องทิ้ง เราก็จะติ้กช่องนี้ ",-1))])])])]),t("div",at,[t("button",{type:"button",onClick:e[11]||(e[11]=a=>u("cancel")),class:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"}," ยกเลิก "),e[23]||(e[23]=t("button",{type:"submit",class:"dark:bg-primary-dark rounded-md border border-transparent bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-opacity-90 dark:text-gray-600"}," บันทึก ",-1))])],32))}},st={class:"rounded-lg bg-white p-4 shadow-md dark:bg-gray-700"},lt={class:"overflow-x-auto"},nt={class:"relative mb-4 w-full md:w-64"},ot={class:"min-w-full bg-white dark:bg-gray-700"},it={key:0},dt={class:"px-4 py-2"},ut={class:"dark:text-primary-dark px-4 py-2 text-right font-semibold text-primary"},mt={class:"px-4 py-2 text-center"},pt={class:"space-x-3"},ct=["onClick"],yt=["onClick"],gt={__name:"IngredientManagementView",setup(h){const y=v([]),d=v(!1),u=v(null),r=v(""),I=w(()=>y.value.map(a=>a.name)),C=w(()=>r.value?y.value.filter(a=>a.name.toLowerCase().includes(r.value.toLowerCase())):y.value);async function x(){y.value=await V.ingredients.orderBy("name").toArray()}function U(){u.value={name:"",purchaseUnit:"กรัม",purchaseQuantity:null,purchasePrice:null},d.value=!0}function g(a){u.value={...a},d.value=!0}function f(){d.value=!1,u.value=null}async function n(a){try{const s=JSON.parse(JSON.stringify(a));s.id?await V.ingredients.update(s.id,s):await V.ingredients.add(s),c.fire({toast:!0,position:"top-end",icon:"success",title:"บันทึกข้อมูลสำเร็จ",showConfirmButton:!1,timer:1e3}),f(),await x()}catch(s){console.error("Save failed:",s),c.fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลได้","error")}}async function e(a,s){if((await c.fire({title:"คุณแน่ใจหรือไม่?",text:`คุณต้องการลบ "${s}" ใช่ไหม? การกระทำนี้ไม่สามารถย้อนกลับได้!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ลบเลย!",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await V.ingredients.delete(a),await x(),await c.fire({toast:!0,position:"top-end",icon:"success",title:"ลบข้อมูลสำเร็จ",showConfirmButton:!1,timer:1e3,timerProgressBar:!0})}catch(l){console.error("Failed to delete ingredient:",l),await c.fire("เกิดข้อผิดพลาด!","ไม่สามารถลบข้อมูลได้","error")}}return Q(x),(a,s)=>{const o=F("font-awesome-icon");return i(),p("div",null,[t("div",st,[t("div",lt,[t("div",{class:"mb-6 flex items-center justify-between"},[s[2]||(s[2]=t("h1",{class:"text-2xl font-bold"},"วัตถุดิบ",-1)),t("button",{onClick:U,class:"dark:bg-primary-dark rounded-lg bg-primary px-4 py-2 text-white transition-opacity hover:bg-opacity-90 dark:text-slate-700"}," + เพิ่มวัตถุดิบใหม่ ")]),t("div",nt,[m(t("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>r.value=l),placeholder:"ค้นหาวัตถุดิบ...",class:"w-full rounded-md border border-gray-300 px-3 py-2 pr-10 dark:border-gray-300 dark:bg-slate-200 dark:text-gray-600"},null,512),[[b,r.value]]),r.value?(i(),p("button",{key:0,onClick:s[1]||(s[1]=l=>r.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700"},[k(o,{icon:"xmark"})])):N("",!0)]),t("table",ot,[s[4]||(s[4]=t("thead",{class:"bg-gray-100"},[t("tr",{class:"dark:bg-gray-600"},[t("th",{class:"px-4 py-2 text-left"},"ชื่อวัตถุดิบ"),t("th",{class:"dark:text-primary-dark px-4 py-2 text-right font-semibold text-primary"}," ราคาต่อกรัม (บาท) "),t("th",{class:"px-4 py-2 text-center"},"จัดการ")])],-1)),t("tbody",null,[C.value.length===0?(i(),p("tr",it,s[3]||(s[3]=[t("td",{colspan:"4",class:"py-4 text-center text-gray-500"}," ไม่พบวัตถุดิบที่ตรงกัน... ",-1)]))):N("",!0),(i(!0),p(L,null,j(C.value,l=>(i(),p("tr",{key:l.id,class:"border-b hover:bg-gray-50 dark:border-b-gray-600 hover:dark:bg-slate-200 hover:dark:text-gray-700"},[t("td",dt,S(l.name),1),t("td",ut,S(l.costPerGram?l.costPerGram.toFixed(2):"N/A"),1),t("td",mt,[t("div",pt,[t("button",{onClick:G=>g(l),class:"text-gray-500 hover:text-secondary"},[k(o,{icon:"pencil"})],8,ct),t("button",{onClick:G=>e(l.id,l.name),class:"text-gray-500 hover:text-primary"},[k(o,{icon:"trash"})],8,yt)])])]))),128))])])])]),d.value?(i(),T(E,{key:0,onClose:f},{default:A(()=>[k(rt,{"initial-data":u.value,"existing-names":I.value,onSave:n,onCancel:f},null,8,["initial-data","existing-names"])]),_:1})):N("",!0)])}}};export{gt as default};
