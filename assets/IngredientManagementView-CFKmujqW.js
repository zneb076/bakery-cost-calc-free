import{r as b,c as h,w as P,a as p,o as i,b as t,t as G,d as V,i as w,j as m,v as y,p as N,f as $,q as D,x as W,n as Y,g as Q,h as F,l as L,F as T,e as j,m as A,_ as E}from"./index-WFeeEGVN.js";import{S as c,d as B}from"./sweetalert2.esm.all-BdfwKlh3.js";import{_ as K}from"./CustomAutocomplete-CnB7zEjX.js";const O={class:"p-6"},_={class:"mb-4 text-2xl font-semibold"},q={class:"space-y-4"},J={class:"grid grid-cols-2 gap-4"},R={key:0,class:"rounded-md bg-blue-50 p-3"},z={class:"mt-4 border-t pt-4"},H={class:"mt-4"},X={class:"flex items-center"},Z=["disabled"],tt={class:"flex justify-end space-x-3 rounded-b-lg bg-gray-50 px-6 py-3"},et={__name:"IngredientForm",props:{initialData:{type:Object,default:()=>({name:"",purchaseUnit:"กรัม",purchaseQuantity:null,purchasePrice:null,defaultYield:100,costByWholeUnit:!1,standardWeightInGrams:null})},existingNames:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(k,{emit:v}){const u=k,d=v,n=b({}),S=b(null),C=h(()=>!!u.initialData.id),f=h(()=>n.value.purchaseUnit&&n.value.purchaseUnit.trim().toLowerCase()!=="กรัม"),U=h(()=>!n.value.purchaseUnit||n.value.purchaseUnit.trim().toLowerCase()==="กรัม");P(()=>u.initialData,o=>{n.value={...o},n.value.defaultYield==null&&(n.value.defaultYield=100)},{immediate:!0,deep:!0});function x(o){Y(()=>{document.getElementById(o)?.focus()})}function g(){const{name:o,purchaseUnit:e,purchaseQuantity:s,purchasePrice:l,standardWeightInGrams:r}=n.value;if(!o||!e||!s||!l){c.fire({icon:"error",title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกข้อมูลหลักให้ครบ"});return}let a=0;if(f.value){if(!r||r<=0){c.fire({icon:"error",title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกน้ำหนักมาตรฐานเป็นกรัม"});return}const M=s*r;a=l/M}else a=l/s;const I={...n.value,costPerGram:a};d("save",I)}return(o,e)=>(i(),p("form",{onSubmit:$(g,["prevent"])},[t("div",O,[t("h3",_,G(k.initialData.id?"แก้ไขวัตถุดิบ":"เพิ่มวัตถุดิบใหม่"),1),t("div",q,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อวัตถุดิบ",-1)),w(K,{ref_key:"autocompleteRef",ref:S,modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.name=s),options:k.existingNames,disabled:C.value,creatable:!0,"show-all-on-focus":!1,placeholder:"ชื่อวัตถุดิบ",onSelectionMade:e[1]||(e[1]=s=>x("price-input")),class:"mt-1"},null,8,["modelValue","options","disabled"])]),t("div",J,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium"},"ราคาที่ซื้อ (บาท)",-1)),m(t("input",{id:"price-input","onUpdate:modelValue":e[2]||(e[2]=s=>n.value.purchasePrice=s),onKeydown:e[3]||(e[3]=N($(s=>x("quantity-input"),["prevent"]),["enter"])),type:"number",step:"0.01",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,n.value.purchasePrice,void 0,{number:!0}]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium"},"จำนวนที่ซื้อ",-1)),m(t("input",{id:"quantity-input","onUpdate:modelValue":e[4]||(e[4]=s=>n.value.purchaseQuantity=s),onKeydown:e[5]||(e[5]=N($(s=>x("unit-input"),["prevent"]),["enter"])),type:"number",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,n.value.purchaseQuantity,void 0,{number:!0}]])])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium"},"หน่วยที่ซื้อ",-1)),m(t("input",{id:"unit-input","onUpdate:modelValue":e[6]||(e[6]=s=>n.value.purchaseUnit=s),onKeydown:e[7]||(e[7]=N($(()=>{},["prevent"]),["enter"])),type:"text",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,n.value.purchaseUnit]])]),f.value?(i(),p("div",R,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-blue-800"},"น้ำหนักมาตรฐานต่อ 1 หน่วย (กรัม)",-1)),e[17]||(e[17]=t("p",{class:"mb-1 text-xs text-gray-500"},"เช่น ไข่ 1 ฟองหนัก 50 กรัม",-1)),m(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.standardWeightInGrams=s),type:"number",class:"mt-1 block w-full rounded-md border p-2"},null,512),[[y,n.value.standardWeightInGrams,void 0,{number:!0}]])])):V("",!0),t("div",z,[e[21]||(e[21]=t("h4",{class:"mb-2 font-semibold text-gray-800"}," การตั้งค่าต้นทุน (ทางเลือก) ",-1)),e[22]||(e[22]=t("p",{class:"mb-4 text-xs text-gray-500"}," ส่วนนี้เป็นค่าที่ตั้งไว้ล่วงหน้าเพื่อการคำนวณที่แม่นยำขึ้น หากไม่ต้องการใช้งาน สามารถข้ามไปได้เลย ",-1)),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700"},"1. Yield เริ่มต้น (%)",-1)),m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.defaultYield=s),type:"number",min:"0",max:"100",class:"mt-1 w-full rounded-md border p-2"},null,512),[[y,n.value.defaultYield,void 0,{number:!0}]]),e[19]||(e[19]=t("p",{class:"mt-1 text-xs text-gray-500"}," คือเปอร์เซ็นต์ของวัตถุดิบที่ใช้ได้จริงหลังการเตรียม เช่น แครอท 100g ปอกเปลือกแล้วเหลือ 80g ให้ใส่ Yield เป็น 80 ",-1))]),e[23]||(e[23]=t("div",{class:"mt-6 border-t"},null,-1)),t("div",H,[t("div",X,[m(t("input",{id:"costByWholeUnit","onUpdate:modelValue":e[10]||(e[10]=s=>n.value.costByWholeUnit=s),disabled:U.value,type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-primary disabled:bg-gray-200"},null,8,Z),[[D,n.value.costByWholeUnit]]),t("label",{for:"costByWholeUnit",class:W(["ml-2 block text-sm",U.value?"text-gray-400":"text-gray-900"])}," 2. คิดต้นทุนเต็มหน่วยเสมอ ",2)]),e[20]||(e[20]=t("p",{class:"ml-6 mt-1 text-xs text-gray-500"}," ใช้สำหรับวัตถุดิบที่ต้องใช้ทั้งหน่วยเสมอ เช่น ไข่ไก่ 1 ฟอง (60กรัม) แต่ในสูตรเราใช้แค่ 25กรัม ที่เหลือเก็บไม่ได้ต้องทิ้ง เราก็จะติ้กช่องนี้ ",-1))])])])]),t("div",tt,[t("button",{type:"button",onClick:e[11]||(e[11]=s=>d("cancel")),class:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"}," ยกเลิก "),e[24]||(e[24]=t("button",{type:"submit",class:"rounded-md border border-transparent bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-opacity-90"}," บันทึก ",-1))])],32))}},st={class:"rounded-lg bg-white p-4 shadow-md"},nt={class:"overflow-x-auto"},lt={class:"relative mb-4 w-full md:w-64"},at={class:"min-w-full bg-white"},ot={key:0},rt={class:"px-4 py-2"},it={class:"px-4 py-2 text-right font-semibold text-primary"},ut={class:"px-4 py-2 text-center"},dt={class:"space-x-3"},mt=["onClick"],pt=["onClick"],yt={__name:"IngredientManagementView",setup(k){const v=b([]),u=b(!1),d=b(null),n=b(""),S=h(()=>v.value.map(s=>s.name)),C=h(()=>n.value?v.value.filter(s=>s.name.toLowerCase().includes(n.value.toLowerCase())):v.value);async function f(){v.value=await B.ingredients.orderBy("name").toArray()}function U(){d.value={name:"",purchaseUnit:"กรัม",purchaseQuantity:null,purchasePrice:null},u.value=!0}function x(s){d.value={...s},u.value=!0}function g(){u.value=!1,d.value=null}async function o(s){try{const l=JSON.parse(JSON.stringify(s));l.id?await B.ingredients.update(l.id,l):await B.ingredients.add(l),c.fire({toast:!0,position:"top-end",icon:"success",title:"บันทึกข้อมูลสำเร็จ",showConfirmButton:!1,timer:1e3}),g(),await f()}catch(l){console.error("Save failed:",l),c.fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลได้","error")}}async function e(s,l){if((await c.fire({title:"คุณแน่ใจหรือไม่?",text:`คุณต้องการลบ "${l}" ใช่ไหม? การกระทำนี้ไม่สามารถย้อนกลับได้!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ลบเลย!",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await B.ingredients.delete(s),await f(),await c.fire({toast:!0,position:"top-end",icon:"success",title:"ลบข้อมูลสำเร็จ",showConfirmButton:!1,timer:1e3,timerProgressBar:!0})}catch(a){console.error("Failed to delete ingredient:",a),await c.fire("เกิดข้อผิดพลาด!","ไม่สามารถลบข้อมูลได้","error")}}return Q(f),(s,l)=>{const r=L("font-awesome-icon");return i(),p("div",null,[t("div",st,[t("div",nt,[t("div",{class:"mb-6 flex items-center justify-between"},[l[2]||(l[2]=t("h1",{class:"text-2xl font-bold"},"วัตถุดิบ",-1)),t("button",{onClick:U,class:"rounded-lg bg-primary px-4 py-2 text-white transition-opacity hover:bg-opacity-90"}," + เพิ่มวัตถุดิบใหม่ ")]),t("div",lt,[m(t("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=a=>n.value=a),placeholder:"ค้นหาวัตถุดิบ...",class:"w-full rounded-md border border-gray-300 px-3 py-2 pr-10"},null,512),[[y,n.value]]),n.value?(i(),p("button",{key:0,onClick:l[1]||(l[1]=a=>n.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700"},[w(r,{icon:"xmark"})])):V("",!0)]),t("table",at,[l[4]||(l[4]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left"},"ชื่อวัตถุดิบ"),t("th",{class:"px-4 py-2 text-right font-semibold text-primary"}," ราคาต่อกรัม (บาท) "),t("th",{class:"px-4 py-2 text-center"},"จัดการ")])],-1)),t("tbody",null,[C.value.length===0?(i(),p("tr",ot,l[3]||(l[3]=[t("td",{colspan:"4",class:"py-4 text-center text-gray-500"}," ไม่พบวัตถุดิบที่ตรงกัน... ",-1)]))):V("",!0),(i(!0),p(T,null,j(C.value,a=>(i(),p("tr",{key:a.id,class:"border-b hover:bg-gray-50"},[t("td",rt,G(a.name),1),t("td",it,G(a.costPerGram?a.costPerGram.toFixed(2):"N/A"),1),t("td",ut,[t("div",dt,[t("button",{onClick:I=>x(a),class:"text-gray-500 hover:text-secondary"},[w(r,{icon:"pencil"})],8,mt),t("button",{onClick:I=>e(a.id,a.name),class:"text-gray-500 hover:text-primary"},[w(r,{icon:"trash"})],8,pt)])])]))),128))])])])]),u.value?(i(),F(E,{key:0,onClose:g},{default:A(()=>[w(et,{"initial-data":d.value,"existing-names":S.value,onSave:o,onCancel:g},null,8,["initial-data","existing-names"])]),_:1})):V("",!0)])}}};export{yt as default};
