import{e as b,f as h,w as P,c as p,o as i,a as e,u as N,j as V,d as w,B as m,C as y,y as I,n as B,G as _,p as D,x as W,h as Q,k as Y,r as E,F,q as L,E as T}from"./index-BjnW3rBN.js";import{S as c,d as $}from"./sweetalert2.esm.all-BmAA-hg4.js";import{_ as j}from"./BaseModal-Bzxuumhg.js";import{_ as A}from"./CustomAutocomplete-Hmzp2hPe.js";const K={class:"p-6"},O={class:"mb-4 text-2xl font-semibold"},q={class:"space-y-4"},J={class:"grid grid-cols-2 gap-4"},R={key:0,class:"rounded-md bg-blue-50 p-3"},z={class:"mt-4 border-t pt-4"},H={class:"mt-4"},X={class:"flex items-center"},Z=["disabled"],ee={class:"flex justify-end space-x-3 rounded-b-lg bg-gray-50 px-6 py-3"},te={__name:"IngredientForm",props:{initialData:{type:Object,default:()=>({name:"",purchaseUnit:"กรัม",purchaseQuantity:null,purchasePrice:null,defaultYield:100,costByWholeUnit:!1,standardWeightInGrams:null})},existingNames:{type:Array,default:()=>[]}},emits:["save","cancel"],setup(k,{emit:v}){const u=k,d=v,s=b({}),S=b(null),C=h(()=>!!u.initialData.id),f=h(()=>s.value.purchaseUnit&&s.value.purchaseUnit.trim().toLowerCase()!=="กรัม"),U=h(()=>!s.value.purchaseUnit||s.value.purchaseUnit.trim().toLowerCase()==="กรัม");P(()=>u.initialData,o=>{s.value={...o},s.value.defaultYield==null&&(s.value.defaultYield=100)},{immediate:!0,deep:!0});function x(o){W(()=>{document.getElementById(o)?.focus()})}function g(){const{name:o,purchaseUnit:t,purchaseQuantity:n,purchasePrice:a,standardWeightInGrams:r}=s.value;if(!o||!t||!n||!a){c.fire({icon:"error",title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกข้อมูลหลักให้ครบ"});return}let l=0;if(f.value){if(!r||r<=0){c.fire({icon:"error",title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกน้ำหนักมาตรฐานเป็นกรัม"});return}const M=n*r;l=a/M}else l=a/n;const G={...s.value,costPerGram:l};d("save",G)}return(o,t)=>(i(),p("form",{onSubmit:B(g,["prevent"])},[e("div",K,[e("h3",O,N(k.initialData.id?"แก้ไขวัตถุดิบ":"เพิ่มวัตถุดิบใหม่"),1),e("div",q,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อวัตถุดิบ",-1)),w(A,{ref_key:"autocompleteRef",ref:S,modelValue:s.value.name,"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.name=n),options:k.existingNames,disabled:C.value,creatable:!0,"show-all-on-focus":!1,placeholder:"พิมพ์เพื่อค้นหาหรือเพิ่มใหม่",onSelectionMade:t[1]||(t[1]=n=>x("price-input")),class:"mt-1"},null,8,["modelValue","options","disabled"])]),e("div",J,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium"},"ราคาที่ซื้อ (บาท)",-1)),m(e("input",{id:"price-input","onUpdate:modelValue":t[2]||(t[2]=n=>s.value.purchasePrice=n),onKeydown:t[3]||(t[3]=I(B(n=>x("quantity-input"),["prevent"]),["enter"])),type:"number",step:"0.01",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,s.value.purchasePrice,void 0,{number:!0}]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium"},"จำนวนที่ซื้อ",-1)),m(e("input",{id:"quantity-input","onUpdate:modelValue":t[4]||(t[4]=n=>s.value.purchaseQuantity=n),onKeydown:t[5]||(t[5]=I(B(n=>x("unit-input"),["prevent"]),["enter"])),type:"number",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,s.value.purchaseQuantity,void 0,{number:!0}]])])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium"},"หน่วยที่ซื้อ",-1)),m(e("input",{id:"unit-input","onUpdate:modelValue":t[6]||(t[6]=n=>s.value.purchaseUnit=n),onKeydown:t[7]||(t[7]=I(B(()=>{},["prevent"]),["enter"])),type:"text",class:"mt-1 w-full rounded-md border p-2"},null,544),[[y,s.value.purchaseUnit]])]),f.value?(i(),p("div",R,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-blue-800"},"น้ำหนักมาตรฐานต่อ 1 หน่วย (กรัม)",-1)),t[17]||(t[17]=e("p",{class:"mb-1 text-xs text-gray-500"},"เช่น ไข่ 1 ฟองหนัก 50 กรัม",-1)),m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=n=>s.value.standardWeightInGrams=n),type:"number",class:"mt-1 block w-full rounded-md border p-2"},null,512),[[y,s.value.standardWeightInGrams,void 0,{number:!0}]])])):V("",!0),e("div",z,[t[19]||(t[19]=e("h4",{class:"mb-2 font-semibold text-gray-800"}," การตั้งค่าต้นทุน (ทางเลือก) ",-1)),t[20]||(t[20]=e("p",{class:"mb-4 text-xs text-gray-500"}," ส่วนนี้เป็นค่าที่ตั้งไว้ล่วงหน้าเพื่อการคำนวณที่แม่นยำขึ้น หากไม่ต้องการใช้งาน สามารถข้ามไปได้เลย ",-1)),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700"},"Yield เริ่มต้น (%)",-1)),m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=n=>s.value.defaultYield=n),type:"number",min:"0",max:"100",class:"mt-1 w-full rounded-md border p-2"},null,512),[[y,s.value.defaultYield,void 0,{number:!0}]])]),e("div",H,[e("div",X,[m(e("input",{id:"costByWholeUnit","onUpdate:modelValue":t[10]||(t[10]=n=>s.value.costByWholeUnit=n),disabled:U.value,type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-primary disabled:bg-gray-200"},null,8,Z),[[_,s.value.costByWholeUnit]]),e("label",{for:"costByWholeUnit",class:D(["ml-2 block text-sm",U.value?"text-gray-400":"text-gray-900"])}," คิดต้นทุนเต็มหน่วยเสมอ ",2)])])])])]),e("div",ee,[e("button",{type:"button",onClick:t[11]||(t[11]=n=>d("cancel")),class:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"}," ยกเลิก "),t[21]||(t[21]=e("button",{type:"submit",class:"rounded-md border border-transparent bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-opacity-90"}," บันทึก ",-1))])],32))}},ne={class:"rounded-lg bg-white p-4 shadow-md"},se={class:"overflow-x-auto"},ae={class:"relative mb-4 w-full md:w-64"},le={class:"min-w-full bg-white"},oe={key:0},re={class:"px-4 py-2"},ie={class:"px-4 py-2 text-right font-semibold text-primary"},ue={class:"px-4 py-2 text-center"},de={class:"space-x-3"},me=["onClick"],pe=["onClick"],be={__name:"IngredientManagementView",setup(k){const v=b([]),u=b(!1),d=b(null),s=b(""),S=h(()=>v.value.map(n=>n.name)),C=h(()=>s.value?v.value.filter(n=>n.name.toLowerCase().includes(s.value.toLowerCase())):v.value);async function f(){v.value=await $.ingredients.orderBy("name").toArray()}function U(){d.value={name:"",purchaseUnit:"กรัม",purchaseQuantity:null,purchasePrice:null},u.value=!0}function x(n){d.value={...n},u.value=!0}function g(){u.value=!1,d.value=null}async function o(n){try{const a=JSON.parse(JSON.stringify(n));a.id?await $.ingredients.update(a.id,a):await $.ingredients.add(a),c.fire({toast:!0,position:"top-end",icon:"success",title:"บันทึกข้อมูลสำเร็จ",showConfirmButton:!1,timer:1e3}),g(),await f()}catch(a){console.error("Save failed:",a),c.fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลได้","error")}}async function t(n,a){if((await c.fire({title:"คุณแน่ใจหรือไม่?",text:`คุณต้องการลบ "${a}" ใช่ไหม? การกระทำนี้ไม่สามารถย้อนกลับได้!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ลบเลย!",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await $.ingredients.delete(n),await f(),await c.fire({toast:!0,position:"top-end",icon:"success",title:"ลบข้อมูลสำเร็จ",showConfirmButton:!1,timer:1e3,timerProgressBar:!0})}catch(l){console.error("Failed to delete ingredient:",l),await c.fire("เกิดข้อผิดพลาด!","ไม่สามารถลบข้อมูลได้","error")}}return Q(f),(n,a)=>{const r=E("font-awesome-icon");return i(),p("div",null,[e("div",ne,[e("div",se,[e("div",{class:"mb-6 flex items-center justify-between"},[a[2]||(a[2]=e("h1",{class:"text-3xl font-bold"},"วัตถุดิบ",-1)),e("button",{onClick:U,class:"rounded-lg bg-primary px-4 py-2 font-bold text-white transition-opacity hover:bg-opacity-90"}," + เพิ่มวัตถุดิบใหม่ ")]),e("div",ae,[m(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=l=>s.value=l),placeholder:"ค้นหาวัตถุดิบ...",class:"w-full rounded-md border border-gray-300 px-3 py-2 pr-10"},null,512),[[y,s.value]]),s.value?(i(),p("button",{key:0,onClick:a[1]||(a[1]=l=>s.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700"},[w(r,{icon:"xmark"})])):V("",!0)]),e("table",le,[a[4]||(a[4]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"ชื่อวัตถุดิบ"),e("th",{class:"px-4 py-2 text-right font-semibold text-primary"}," ราคาต่อกรัม (บาท) "),e("th",{class:"px-4 py-2 text-center"},"จัดการ")])],-1)),e("tbody",null,[C.value.length===0?(i(),p("tr",oe,a[3]||(a[3]=[e("td",{colspan:"4",class:"py-4 text-center text-gray-500"}," ไม่พบวัตถุดิบที่ตรงกัน... ",-1)]))):V("",!0),(i(!0),p(F,null,L(C.value,l=>(i(),p("tr",{key:l.id,class:"border-b hover:bg-gray-50"},[e("td",re,N(l.name),1),e("td",ie,N(l.costPerGram?l.costPerGram.toFixed(2):"N/A"),1),e("td",ue,[e("div",de,[e("button",{onClick:G=>x(l),class:"text-gray-500 hover:text-secondary"},[w(r,{icon:"pencil"})],8,me),e("button",{onClick:G=>t(l.id,l.name),class:"text-gray-500 hover:text-primary"},[w(r,{icon:"trash"})],8,pe)])])]))),128))])])])]),u.value?(i(),Y(j,{key:0,onClose:g},{default:T(()=>[w(te,{"initial-data":d.value,"existing-names":S.value,onSave:o,onCancel:g},null,8,["initial-data","existing-names"])]),_:1})):V("",!0)])}}};export{be as default};
